<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width initial-scale=1" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-75757763-1', 'auto');
  ga('send', 'pageview');
  </script>

  <title>Startup Actions on Pentaho: PentahoHttpSession VS UserSession</title>
  <meta name="description" content="My name is Miguel Gaspar and the blog purpose is to provide information on the value and how to build IoT and Big Data solutions, providing business, architectural and technical guidance that can be useful to developers, architects and top level business managers. ">
  <meta name="author" content="Miguel Gaspar">
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="keywords" content="analytics,big data,iot,social innovation,bi,business intelligence,ctools,pentaho,real-time,realtime,live,insights,analysis,dashboards,artificial intelligence,machine learning'>

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Cooking Analytics">
  <meta name="twitter:description" content="My name is Miguel Gaspar and the blog purpose is to provide information on the value and how to build IoT and Big Data solutions, providing business, architectural and technical guidance that can be useful to developers, architects and top level business managers. ">

  <meta property="og:type" content="article">
  <meta property="og:title" content="Cooking Analytics">
  <meta property="og:description" content="My name is Miguel Gaspar and the blog purpose is to provide information on the value and how to build IoT and Big Data solutions, providing business, architectural and technical guidance that can be useful to developers, architects and top level business managers. ">

  <link rel="apple-touch-icon" sizes="57x57" href="/images/favicons/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/images/favicons/apple-touch-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/images/favicons/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/images/favicons/apple-touch-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/images/favicons/apple-touch-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/images/favicons/apple-touch-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/images/favicons/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/images/favicons/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="/images/favicons/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="/images/favicons/favicon-16x16.png" sizes="16x16">
  <link rel="manifest" href="/images/favicons/manifest.json">
  <link rel="shortcut icon" href="/images/favicons/favicon.ico">
  <meta name="msapplication-TileColor" content="#ffc40d">
  <meta name="msapplication-TileImage" content="/images/favicons/mstile-144x144.png">
  <meta name="theme-color" content="#ffffff">

  <link rel="stylesheet" href="/css/main.css">
  <link rel="canonical" href="http://localhost:4000//2016/Startup-Actions-on-Pentaho/">
  <link rel="alternate" type="application/rss+xml" title="Cooking Analytics" href="/feed.xml">
</head>


  <body>
    <span class="mobile btn-mobile-menu">
  <i class="icon icon-list btn-mobile-menu__icon"></i>
  <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
</span>
  
<header class="panel-cover" style="background-image: url(/images/cover.jpg)">
  <div class="panel-main">

    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">
        <a href="/" title="link to home of Cooking Analytics">
          <img src="/images/profile.jpg" class="user-image" alt="My Profile Photo">
          <h1 class="panel-cover__title panel-title">Cooking Analytics</h1>
        </a>
        <hr class="panel-cover__divider">
        <p class="panel-cover__description">My name is Miguel Gaspar and the blog purpose is to provide information on the value and how to build IoT and Big Data solutions, providing business, architectural and technical guidance that can be useful to developers, architects and top level business managers. </p>
        <hr class="panel-cover__divider panel-cover__divider--secondary">

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">
              <li class="navigation__item"><a href="/#blog" title="link to Cooking Analytics blog" class="blog-button">Blog</a></li>
            </ul>
          </nav>

          <nav class="cover-navigation navigation--social">
            <ul class="navigation">
          
            
              <!-- Twitter -->
              <li class="navigation__item">
                <a href="http://twitter.com/migfgaspar" title="@migfgaspar on Twitter" target="_blank">
                  <i class="icon icon-social-twitter"></i>
                  <span class="label">Twitter</span>
                </a>
              </li>
            

            
              <!-- Facebook -->
              <li class="navigation__item">
                <a href="http://fb.me/miguel.ferreira.gaspar" title="miguel.ferreira.gaspar on Facebook" target="_blank">
                  <i class="icon icon-social-facebook"></i>
                  <span class="label">Facebook</span>
                </a>
              </li>
            

            
              <!-- LinkedIn -->
              <li class="navigation__item">
                <a href="https://www.linkedin.com/in/mfgaspar" title="mfgaspar on LinkedIn" target="_blank">
                  <i class="icon icon-social-linkedin"></i>
                  <span class="label">LinkedIn</span>
                </a>
              </li>
            

            
              <!-- GitHub -->
              <li class="navigation__item">
                <a href="https://www.github.com/mfgaspar" title="mfgaspar on GitHub" target="_blank">
                  <i class="icon icon-social-github"></i>
                  <span class="label">GitHub</span>
                </a>
              </li>
            

            
              <!-- Email -->
              <li class="navigation__item">
                <a href="mailto:miguel.ferreira.gaspar@gmail.com" title="Email miguel.ferreira.gaspar@gmail.com" target="_blank">
                  <i class="icon icon-mail"></i>
                  <span class="label">Email</span>
                </a>
              </li>
            

            <!-- RSS -->
            <li class="navigation__item">
              <a href="/feed.xml" title="Subscribe" target="_blank">
                <i class="icon icon-rss"></i>
                <span class="label">RSS</span>
              </a>
            </li>
          
            </ul>
          </nav>

        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>


    <div class="content-wrapper">
      <div class="content-wrapper__inner">
        <article class="post-container post-container--single">
  <header class="post-header">
    <div class="post-meta">
      <time datetime="23 Oct 2016" class="post-meta__date date">23 Oct 2016</time> &#8226; <span class="post-meta__tags">on <a href="/tags/#Startup Actions">Startup Actions</a> <a href="/tags/#Action Sequences">Action Sequences</a> </span>
    </div>
    <h1 class="post-title">Startup Actions on Pentaho: PentahoHttpSession VS UserSession</h1>
  </header>
  <section class="post">
    <p>There might be easier ways to deal with some actions that you need to execute during the user login or during the start of the server itself, anyhow action sequences are still very usefull. For sure you already know about te content of this post, anyhow I needed to write it as an introduction for the next post I will be writting.</p>

<p>Pentaho created a tools called <a href="http://pedroalves-bi.blogspot.com/2014/02/startup-rule-engine-new-sparkl-app-in.html">Startup Rule Engine</a> and was covered in Pedro Alves blog, some time ago, but that’s what will covered in this blogpost.</p>

<p>When we have a multitenant environment, or we need to have one, we can use an Action Sequence to run some actions. Mondrian is capable of handling multitenancy in different ways, and one of ways is to use a DSP (Dynamic Schema Processor), information that can be found in the help pages of Pentaho, <a href="https://help.pentaho.com/Documentation/6.1/0R0/070/Multi-Tenancy">here</a>. When using a DSP, most probably, you will need to create session variables that can be used latter in the DSP. Besides that, Startup Rule Engine, Action Sequences can easily be set and used to set the sessions variables you will need.</p>

<p>Please keep in mind that a session variable is already set when a user is logged in, and you can use it, but the value will be the username of the user that logged in. So it can be used when you are able to use it to do the filtering of the data that will be available. Otherwise you need to use some alternatives.  An example is when a user does the login we can trigger a SQL query that will set the session variable with the tenant id to be used, where the tenant id is not the username. That can later be used on Mondrian.</p>

<p>The example bellow, is from an xaction that depending on the user that logged in, sets the value for a session variable named “REGION”. If the logged in user it’s “joe”, the xaction will create a session variable with the values “APAC” so we will be able to restrict the access to user “joe”, to be only able to see “APAC” results, while “suzy” will could have access to “EMEA” and the remaining users will have access to all.</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="cp">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
	<span class="nt">&lt;action-sequence&gt;</span> 
	  <span class="nt">&lt;name&gt;</span>session-region.xaction<span class="nt">&lt;/name&gt;</span>
	  <span class="nt">&lt;title&gt;</span>%title<span class="nt">&lt;/title&gt;</span>
	  <span class="nt">&lt;version&gt;</span>1<span class="nt">&lt;/version&gt;</span>
	  <span class="nt">&lt;logging-level&gt;</span>debug<span class="nt">&lt;/logging-level&gt;</span>
	  <span class="nt">&lt;documentation&gt;</span> 
	    <span class="nt">&lt;author&gt;</span>%author<span class="nt">&lt;/author&gt;</span>  
	    <span class="nt">&lt;description&gt;</span>%desciption<span class="nt">&lt;/description&gt;</span>  
	    <span class="nt">&lt;help/&gt;</span> 
	  <span class="nt">&lt;/documentation&gt;</span>

	  <span class="nt">&lt;inputs&gt;</span> 
	    <span class="nt">&lt;user</span> <span class="na">type=</span><span class="s">"string"</span><span class="nt">&gt;</span> 
	      <span class="nt">&lt;sources&gt;</span> 
	        <span class="nt">&lt;session&gt;</span>name<span class="nt">&lt;/session&gt;</span> 
	      <span class="nt">&lt;/sources&gt;</span> 
	    <span class="nt">&lt;/user&gt;</span>  
	  <span class="nt">&lt;/inputs&gt;</span>

	  <span class="nt">&lt;outputs&gt;</span> 
	    <span class="nt">&lt;user</span> <span class="na">type=</span><span class="s">"string"</span><span class="nt">&gt;</span>
	      <span class="nt">&lt;destinations&gt;</span>
	        <span class="nt">&lt;session&gt;</span>user<span class="nt">&lt;/session&gt;</span>
	      <span class="nt">&lt;/destinations&gt;</span>
	    <span class="nt">&lt;/user&gt;</span>
	    <span class="nt">&lt;REGION</span> <span class="na">type=</span><span class="s">"string"</span><span class="nt">&gt;</span>
	      <span class="nt">&lt;destinations&gt;</span>
	        <span class="nt">&lt;session&gt;</span>REGION<span class="nt">&lt;/session&gt;</span>
	      <span class="nt">&lt;/destinations&gt;</span>
	    <span class="nt">&lt;/REGION&gt;</span>
	  <span class="nt">&lt;/outputs&gt;</span>

	  <span class="nt">&lt;resources/&gt;</span>
	  
	  <span class="nt">&lt;actions&gt;</span> 
	    <span class="nt">&lt;action-definition&gt;</span> 
	      <span class="nt">&lt;component-name&gt;</span>JavascriptRule<span class="nt">&lt;/component-name&gt;</span>
	      <span class="nt">&lt;action-type&gt;</span>JavaScript To Build User Specific Result Set<span class="nt">&lt;/action-type&gt;</span>
	      <span class="nt">&lt;action-inputs&gt;</span> 
	        <span class="nt">&lt;user</span> <span class="na">type=</span><span class="s">"string"</span><span class="nt">/&gt;</span> 
	      <span class="nt">&lt;/action-inputs&gt;</span>
	      <span class="nt">&lt;action-outputs&gt;</span> 
	        <span class="nt">&lt;REGION</span> <span class="na">type=</span><span class="s">"string"</span><span class="nt">/&gt;</span> 
	      <span class="nt">&lt;/action-outputs&gt;</span>
	      <span class="nt">&lt;component-definition&gt;</span> 
	        <span class="nt">&lt;script&gt;</span><span class="cp">&lt;![CDATA[function getRegions( user ) {
						    var region = "none";
				      	if( user == 'joe' ) { region = "APAC"; } 
				      	else if( user == 'suzy' ) { region = "EMEA"; } 
	              else { region = "EMEA, APAC, ..."; }
				      	return res;
				      }
	            getRegions( user );
	        ]]&gt;</span><span class="nt">&lt;/script&gt;</span> 
	      <span class="nt">&lt;/component-definition&gt;</span> 
	    <span class="nt">&lt;/action-definition&gt;</span>
	 
	  <span class="nt">&lt;/actions&gt;</span> 
	<span class="nt">&lt;/action-sequence&gt;</span>
</code></pre></div></div>

<p>Once you have the action sequence ready, you need to upload it to the repository to be able to execute it, and if you execute from the Pentaho User Console when using the user “Suzy”, you will get something like:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Action Successful
-----------------
user=suzy
REGION=EMEA
</code></pre></div></div>

<p>Now that you have the action sequence in place, you need to make sure to execute it when the user logs in. For that we need to edit the file: ../pentaho-solutions/system/sessionStartupActions.xml. There you will find something like:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="highlight"><code>	<span class="c">&lt;!-- Start of PentahoHttpSession startup actions. --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.pentaho.platform.engine.core.system.SessionStartupAction"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"sessionType"</span> <span class="na">value=</span><span class="s">"org.pentaho.platform.web.http.session.PentahoHttpSession"</span><span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"actionPath"</span> <span class="na">value=</span><span class="s">"/public/your_xaction_path_and_file.xaction"</span><span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"actionOutputScope"</span> <span class="na">value=</span><span class="s">"session"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	<span class="c">&lt;!-- End of PentahoHttpSession startup actions. --&gt;</span>				
	<span class="c">&lt;!-- Start of UserSession startup actions. --&gt;</span>
	<span class="nt">&lt;bean</span> <span class="na">class=</span><span class="s">"org.pentaho.platform.engine.core.system.SessionStartupAction"</span><span class="nt">&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"sessionType"</span> <span class="na">value=</span><span class="s">"org.pentaho.platform.engine.core.system.UserSession"</span><span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"actionPath"</span> <span class="na">value=</span><span class="s">"/public/your_xaction_path_and_file.xaction"</span><span class="nt">/&gt;</span>
		<span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">"actionOutputScope"</span> <span class="na">value=</span><span class="s">"session"</span><span class="nt">/&gt;</span>
	<span class="nt">&lt;/bean&gt;</span>
	<span class="c">&lt;!-- End of UserSession startup actions. --&gt;</span>
    <span class="c">&lt;!-- Start of Global startup actions. --&gt;</span>
    <span class="c">&lt;!-- &lt;bean class="org.pentaho.platform.engine.core.system.SessionStartupAction"&gt;
    	&lt;property name="sessionType" value="org.pentaho.platform.engine.security.session.TrustedSystemStartupSession"/&gt;
        &lt;property name="actionPath" value="/public/your_xaction_path_and_file.xaction"/&gt;
        &lt;property name="actionOutputScope" value="global"/&gt;
    &lt;/bean&gt; --&gt;</span>
    <span class="c">&lt;!-- End of Global startup actions. --&gt;</span>
</code></pre></div></div>

<p>You can see 3 groups starting by the tag <bean>. By default, they are commented and you can uncomment them if you want to have startup actions to run when the user performs a login or when Pentaho is starting. Each one of this groups is identified by the type and very important the action sequence path to be executed. The actionPath needs to be set, pointing to the folder/file of the xaction we want to be execute.  You will see session type is what makes the bid difference from group to group, and it can get the following values:</bean></p>

<ul>
  <li>org.pentaho.platform.web.http.session.PentahoHttpSession</li>
  <li>org.pentaho.platform.engine.core.system.UserSession</li>
  <li>org.pentaho.platform.engine.security.session.TrustedSystemStartupSession</li>
</ul>

<p>Let’s see them as just:</p>

<ul>
  <li>
    <p>PentahoHttpSession: runs the specified action sequence when a session is created using HTTP. Useful to run some actions, as creating a session variable to be used on a DSP when the user is logged in from a browser.</p>
  </li>
  <li>
    <p>UserSession: runs the specified action sequence when a user session is created. Useful to create or run actions like creating a session variable when a session is created, not specifically from the browser, but per instance when the scheduler need to run a report on behalf of the user.</p>
  </li>
  <li>
    <p>TrustedSystemStartupSession: runs the specified action sequence when the Pentaho Server is starting. Useful when you want to execute some operations at the start of the system. Please note that this is executed on the system, so it is globally applied, not for a specific user.</p>
  </li>
</ul>

<p>if you upload the action sequence that is included as example and if you remove the comments from both PentahoHttpSession and UserSession, the session variable will be created when a session is created for a user, independently if it was created from the browser by the user, or by the Pentaho scheduler.</p>

<p>Please keep in mind that you can also use the Startup Rule Engine to perform what was explainded here for the xaction.</p>

<p><strong>Note</strong>: Before making use of a multitenant environment when using Pentaho Community Edition, make sure to completely read the terms and conditions of the software licenses.</p>

<p>Follow me at <a href="https://twitter.com/migfgaspar">Twitter</a></p>


  </section>
  
</article>
 
<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-571518f68ebfed3f"></script>


<a href="https://api.addthis.com/oexchange/0.8/forward/twitter/offer?url=http://localhost:4000/2016/Startup-Actions-on-Pentaho/&text=&pco=tbxnj-1.0&pubid=&ct=1" target="_blank"><img src="https://cache.addthiscdn.com/icons/v3/thumbs/32x32/twitter.png" border="0" alt="Twitter"/></a>

<a href="https://api.addthis.com/oexchange/0.8/forward/linkedin/offer?url=http://localhost:4000/2016/Startup-Actions-on-Pentaho/&pubid=&ct=1&summary=&pco=tbxnj-1.0" target="_blank"><img src="https://cache.addthiscdn.com/icons/v3/thumbs/32x32/linkedin.png" border="0" alt="LinkedIn"/></a>

<a href="https://api.addthis.com/oexchange/0.8/forward/facebook/offer?url=http://localhost:4000/2016/Startup-Actions-on-Pentaho/&pubid=&ct=1&title=&pco=tbxnj-1.0" target="_blank"><img src="https://cache.addthiscdn.com/icons/v3/thumbs/32x32/facebook.png" border="0" alt="Facebook"/></a>

<a href="https://api.addthis.com/oexchange/0.8/forward/google_plus_one/offer?url=http://localhost:4000/2016/Startup-Actions-on-Pentaho/&pubid=&ct=1&title=&pco=tbxnj-1.0" target="_blank"><img src="https://cache.addthiscdn.com/icons/v3/thumbs/32x32/google_plusone_share.png" border="0" alt="Google+"/></a>
<!--
<a href="https://api.addthis.com/oexchange/0.8/forward/link/offer?url=http%3A%2F%2Fwww.addthis.com&pubid=ra-571518f68ebfed3f&ct=1&title=AddThis%20-%20Get%20likes%2C%20get%20shares%2C%20get%20followers&pco=tbxnj-1.0" target="_blank"><img src="https://cache.addthiscdn.com/icons/v3/thumbs/32x32/link.png" border="0" alt="Copy Link"/></a>
-->

<div id="disqus_thread"></div>
<script>
/**
* RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
* LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables
*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL; // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = '//cookinganalytics.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>






      </div>

      <footer class="footer">
  <span class="footer__copyright">&copy; 2017 Miguel Gaspar. All rights reserved.</span>
</footer> 

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script type="text/javascript" src="/js/main.js"></script>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-75757763-1', 'auto');
  ga('send', 'pageview');
</script>

    </div>
  </body>
</html>